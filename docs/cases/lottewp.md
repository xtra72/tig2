[[_TOC_]]

# 롯데워터파크 수질 관리

## 센서 지도(Sensor Map)
```yaml
application: 롯데워터파크
# 연구 개발 중 ...
```

## 토픽 나무(Topic Tree)

아래 쓰임새에 따라 센서 지도로부터 토픽 나무를 만든다.

1. 수질 관리
1. 장치 관리

토픽 나무는 [토픽 나무 설계 안내](../topic.md)를 따른다.

## 수질 관리

수질 관리를 위한 원격측정(telemetry) 데이터를 송수신하는 토픽의 문법은 아래와 같다.

```
data/lottewp/<pool name>/<sensor id>/<측정치>
# 예시: data/lottewp/키즈풀/미니슬라이드/01/cl
# 예시: data/lottewp/키즈풀/미니슬라이드/01/ph
# 예시: data/lottewp/키즈풀/미니슬라이드/01/temperature
```
  - 세션 # clean-start session id is implicitly generated by mqtt server
    - persistent: 0, id: NULL 
  - 메시지
    - QoS: 0
    - payload = { "time": nanosecond, "value": 측정치 } 
      - 보기 = { "time": 1602831661, "value": 12.345 }
    - 측정치
      - 수소이온농도: topic: ph, unit: pH, range: 0..14, type: 실수, precision: .123
      - 유리잔류염소: topic: cl, unit: mg/L, range: 0..5, type: 실수, precision: .123
      - 온도: topic: temperature, unit: Centigrade, range: 1..100, type: 실수, precision: .123

> [워터파트 수질 기준 강화 추진, 연합뉴스, 2020 년 7 월 26 일 ](https://www.yna.co.kr/view/AKR20200722096100030)
>
> 우선 워터파크는 관광진흥법 시행규칙에 규정이 마련돼 있다.
>
>워터파크는 ▲ 유리잔류염소 0.4∼2.0㎎/ℓ ▲ 수소이온농도 5.8∼8.6 ▲ 탁도 2.8NTU 이하 ▲ 과망간산칼륨 소비량 15㎎/ℓ 이하 ▲ 각 풀의 대장균군이 10㎖들이 시험대상 5개 중 양성이 2개 이하 등의 기준을 갖춰야 한다.
>
>반면, 체육시설의 설치·이용에 관한 법률 시행규칙에서 다루는 수영장은 이보다 다소 기준이 높다.
>
>수영장은 ▲ 유리잔류염소 0.4∼1㎎/ℓ ▲ 수소이온농도 5.8∼8.6 ▲ 탁도 1.5NTU 이하 ▲ 과망간산칼륨 소비량 12㎎/ℓ 이하 ▲ 총대장균군이 10㎖ 시험대상 5개 중 양성이 2개 이하 등이 요구된다.
>
>또 관련 규정이 아예 없는 워터파크와는 달리 수영장은 ▲ 비소 0.05㎎/ℓ 이하 ▲ 수은 0.007㎎/ℓ 이하 ▲ 알루미늄 0.5㎎/ℓ 이하 ▲ 결합잔류염소 최대 0.5㎎/ℓ 이하 등도 지켜야 한다.

## 장치 관리

장치 관리를 위한 원격측정 데이터는 아래 토픽 나무로부터 수집한다.

### 장치 상태
```
data/lottewp/gateway/<gateway id>/status
data/lottewp/gateway/<gateway id>/sensor/<sensor id>/status
```
  - 세션
    - persistent: 0, id: NULL
  - 메시지
    - QoS: 0, retain: true
    - LWT
      - retain: true, QoS: 0
    - payload = { "time": nanosecond, "value": 측정치 }
    - 측정치: type: 정수, range: 0..1
      - thresholds: 꺼짐 = 0, 켜짐 = 1

### LTE 무선 환경 지료
```
data/lottewp/gateway/<gateway id>/signal
```
  - 세션
    - persistent: 0, id: NULL 
  - 메시지
    - QoS: 0
    - payload = { "time": nanosecond, "rsrp":RSRP, "rsrq":RSRQ, "sinr":SINR, "rssi":RSSI } 
      - 보기  = { "time": 1602831661, "rsrp":-94,  "rsrq":-9,   "sinr":9,    "rssi":-65  }
    - 측정치: unit: dBm, type: 정수, precision: 123.1
      - RSRP 
        - range: -40..-140
        - thresholds: excellent: >= -80, good: -80..-90, poor: -90..-100, bad: <= -100
      - RSRQ 
        - range: -3..-20
        - thresholds: excellent: >= -10, good: -10..-15, poor: -15..-20, bad: <  -20
      - SINR
        - thresholds: excellent: >= 20, good: 20..13, poor: 13..0, bad: <= 0
      - RSSI
        - range: -1..-100
        - thresholds: excellent: >= -65, good: -65..-75, poor: -75..-85, bad: -85..095

### 장치 성능

```
data/lottewp/gateway/021/cpu
```
```
data/lottewp/gateway/021/disk
```
```
data/lottewp/gateway/021/wan
```

### 장치 사양

```
data/lottewp/gateway/<gateway id>/spec
data/lottewp/gateway/<gateway id>/sensor/<sensor id>/spec
```

## 참고 문헌
1. [RSRP, RSRQ, RSSI, SINR Interplay](https://www.sharetechnote.com/html/Handbook_LTE_RSRP_RSRQ_SINR_Interplay.html)
1. [RSRP and RSRQ](https://wiki.teltonika-networks.com/view/RSRP_and_RSRQ)
